[platformio]
test_dir = piotest
src_dir = ../src/

# TODO: add `-t coverage` via python scripting?
# TODO: do we need `-O0`?

# To prepare coverage data for lcov, add ${coverage.build_flags} to env:test build flags
# To actually generate coverage report:
# $ `pio test` / run the test `program` manually
# $ lcov --include (readlink -f ../espurna)'/*' --capture --directory .pio/build/test/ --output-file test.info
# $ genhtml --ignore-errors source test.info --output-directory out

[coverage]
build_flags = -lgcov -fprofile-arcs -ftest-coverage

[env:test]
platform = native
lib_compat_mode = off
test_build_project_src = true
lib_deps =
    https://github.com/bxparks/UnixHostDuino#64d0090c
build_flags =
    -std=gnu++11
    -Os
    -Wall
    -DUNIX_HOST_DUINO
    -DRPNLIB_ADVANCED_MATH
